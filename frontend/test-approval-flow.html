<!DOCTYPE html>
<html>
<head>
    <title>Wholesale Approval Flow Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Wholesale Approval Flow Debugger</h1>
    
    <div class="section">
        <h2>Step 1: Check localStorage Data</h2>
        <button onclick="checkStorage()">Check All Storage</button>
        <pre id="storage-output"></pre>
    </div>

    <div class="section">
        <h2>Step 2: Simulate User Application</h2>
        <input type="email" id="userEmail" placeholder="User email" value="test@example.com">
        <input type="text" id="businessName" placeholder="Business name" value="Test Business">
        <input type="text" id="businessAddress" placeholder="Business address" value="123 Test St">
        <button onclick="createApplication()">Create Application</button>
        <pre id="app-output"></pre>
    </div>

    <div class="section">
        <h2>Step 3: Simulate Admin Approval</h2>
        <button onclick="getAllApps()">Get All Applications</button>
        <button onclick="approveFirst()">Approve First Application</button>
        <pre id="approve-output"></pre>
    </div>

    <div class="section">
        <h2>Step 4: Check User Updates</h2>
        <button onclick="checkUserUpdates()">Check user_updates</button>
        <pre id="updates-output"></pre>
    </div>

    <script>
        function checkStorage() {
            const output = document.getElementById('storage-output');
            const data = {
                current_user: localStorage.getItem('user'),
                applications: localStorage.getItem('wholesale_applications'),
                user_updates: localStorage.getItem('user_updates')
            };
            output.textContent = JSON.stringify(data, null, 2);
        }

        function createApplication() {
            const email = document.getElementById('userEmail').value;
            const businessName = document.getElementById('businessName').value;
            const businessAddress = document.getElementById('businessAddress').value;

            const app = {
                id: `app_${Date.now()}`,
                userId: `user_${Date.now()}`,
                userName: 'Test User',
                userEmail: email,
                businessName: businessName,
                businessAddress: businessAddress,
                status: 'pending',
                appliedAt: new Date().toISOString()
            };

            const apps = JSON.parse(localStorage.getItem('wholesale_applications') || '[]');
            apps.push(app);
            localStorage.setItem('wholesale_applications', JSON.stringify(apps));

            document.getElementById('app-output').textContent = 'Application created:\n' + JSON.stringify(app, null, 2);
        }

        function getAllApps() {
            const apps = JSON.parse(localStorage.getItem('wholesale_applications') || '[]');
            document.getElementById('approve-output').textContent = 'All applications:\n' + JSON.stringify(apps, null, 2);
        }

        function approveFirst() {
            const apps = JSON.parse(localStorage.getItem('wholesale_applications') || '[]');
            if (apps.length === 0) {
                document.getElementById('approve-output').textContent = 'No applications to approve!';
                return;
            }

            const app = apps[0];
            app.status = 'approved';
            app.reviewedAt = new Date().toISOString();
            apps[0] = app;
            localStorage.setItem('wholesale_applications', JSON.stringify(apps));

            // Update user_updates
            const userUpdates = JSON.parse(localStorage.getItem('user_updates') || '{}');
            userUpdates[app.userEmail] = 'wholesale_verified';
            localStorage.setItem('user_updates', JSON.stringify(userUpdates));

            document.getElementById('approve-output').textContent = 
                'Approved!\nApplication: ' + JSON.stringify(app, null, 2) + 
                '\n\nuser_updates: ' + JSON.stringify(userUpdates, null, 2);
        }

        function checkUserUpdates() {
            const updates = localStorage.getItem('user_updates');
            document.getElementById('updates-output').textContent = 
                'user_updates:\n' + JSON.stringify(JSON.parse(updates || '{}'), null, 2);
        }

        // Auto-check on load
        window.onload = checkStorage;
    </script>
</body>
</html>
